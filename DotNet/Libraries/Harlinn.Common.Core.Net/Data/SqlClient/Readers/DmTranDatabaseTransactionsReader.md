# DmTranDatabaseTransactionsReader — reference

Overview

`DmTranDatabaseTransactionsReader` wraps `sys.dm_tran_database_transactions` and exposes per-database transaction details such as LSNs, log usage and status.

Reader SQL

```
SELECT
  dtdt.[transaction_id],
  dtdt.[database_id],
  dtdt.[database_transaction_begin_time],
  dtdt.[database_transaction_type],
  dtdt.[database_transaction_state],
  dtdt.[database_transaction_status],
  dtdt.[database_transaction_status2],
  dtdt.[database_transaction_log_record_count],
  dtdt.[database_transaction_replicate_record_count],
  dtdt.[database_transaction_log_bytes_used],
  dtdt.[database_transaction_log_bytes_reserved],
  dtdt.[database_transaction_log_bytes_used_system],
  dtdt.[database_transaction_log_bytes_reserved_system],
  dtdt.[database_transaction_begin_lsn],
  dtdt.[database_transaction_last_lsn],
  dtdt.[database_transaction_most_recent_savepoint_lsn],
  dtdt.[database_transaction_commit_lsn],
  dtdt.[database_transaction_last_rollback_lsn],
  dtdt.[database_transaction_next_undo_lsn]
FROM
  [sys].[dm_tran_database_transactions] dtdt
```

Columns and interpretation

- `transaction_id` — transaction identifier.
- `database_id` — database id where the transaction executes.
- `database_transaction_begin_time` — start time of the database transaction.
- `database_transaction_type` — numeric type of database transaction.
- `database_transaction_state` — numeric state code.
- `database_transaction_status`, `database_transaction_status2` — status codes providing additional state details.
- `database_transaction_log_record_count` — number of log records generated by the transaction.
- `database_transaction_replicate_record_count` — number of replicate records for the transaction (replication related).
- `database_transaction_log_bytes_used` / `database_transaction_log_bytes_reserved` — bytes used and reserved in the log by the transaction.
- `database_transaction_log_bytes_used_system` / `database_transaction_log_bytes_reserved_system` — system-reserved log bytes usage.
- `database_transaction_begin_lsn`, `database_transaction_last_lsn`, `database_transaction_most_recent_savepoint_lsn`, `database_transaction_commit_lsn`, `database_transaction_last_rollback_lsn`, `database_transaction_next_undo_lsn` — LSN markers indicating positions in the transaction log relevant to the transaction.

How to interpret

- Use LSN markers to correlate with log records and recovery operations.
- High log bytes used or record counts indicate heavy logging activity by a transaction.

Example

```csharp
using var cmd = conn.CreateCommand();
cmd.CommandText = DmTranDatabaseTransactionsReader.Sql;
using var rdr = cmd.ExecuteReader();
var r = new DmTranDatabaseTransactionsReader(rdr, ownsReader:false);
while (r.Read())
{
    Console.WriteLine($"Tx:{r.TransactionId} DB:{r.DatabaseId} Begin:{r.DatabaseTransactionBeginTime} LogBytesUsed:{r.DatabaseTransactionLogBytesUsed}");
}
```

See also:

- [sys.dm_tran_database_transactions](https://learn.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions)
